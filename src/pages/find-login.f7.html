<template>

  <div class="page" data-name="find-login" id="my-find-screen">
    <div class="navbar">
      <div class="navbar-bg"></div>
      <div class="navbar-inner">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="if-not-md">Back</span>
          </a>
        </div>
        <div class="title">JJIM</div>
        <div class="subnavbar">
          <div class="subnavbar-inner">
            <div class="segmented segmented-raised">
              <a class="button tab-link tab-link-active" href="#tab1">이메일</a>
              <a class="button tab-link" href="#tab2">비밀번호</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="page-content hide-navbar-on-scroll">
      <div class="tabs">
        <!--탭1-->
        <div class="tab tab-active" id="tab1">
          <div class="block">
            <br><br>
            <!--아비 찾기 텍스트는 탭 안으로 넣기-->
            <div class="login-screen-title">이메일 찾기</div>
            <!--정보 입력-->
            <form id="tap1">
              <div class="list no-hairlines-md">
                <ul>
                  <li>
                    <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-title item-label">이름</div>
                        <div class="item-input-wrap">
                          <input type="text" name="name" placeholder="" />
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-title item-label">휴대전화</div>
                        <div class="item-input-wrap">
                          <input type="number" name="hp" placeholder="'-'를 제외하고 입력하세요" />
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </form>
            <!--버튼-->
            <div class="block">
              <p class="row">
                <a href="#" class="col button" @click="idAlert">확인</a>
              </p>
            </div>
          </div>
        </div>

        <!--탭2-->
        <div class="tab" id="tab2">
          <div class="block">
            <br><br>
            <!--아비 찾기 텍스트는 탭 안으로 넣기-->
            <div class="login-screen-title">비밀번호 찾기</div>

            <!--정보 입력-->
            <form id="tap2">
              <div class="list no-hairlines-md">
                <ul>
                  <li>
                    <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-title item-label">이메일</div>
                        <div class="item-input-wrap">
                          <input type="email" name="email" placeholder="" />
                        </div>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="item-content item-input">
                      <div class="item-inner">
                        <div class="item-title item-label">휴대전화</div>
                        <div class="item-input-wrap">
                          <input type="number" name="hp" placeholder="'-'를 제외하고 입력하세요" />
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </form>
            <!--버튼-->
            <div class="block">
              <p class="row">
                <a href="#" class="col button" @click="pwAlert">확인</a>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
  export default {
    methods: {

      // 이메일 찾기 함수
      idAlert: function () {
        var self = this;
        var app = self.$app
        var tapData_id = app.form.convertToData('#tap1');
        var usersDB = firebase.firestore().collection("users");
        var dbEmail, dbName, dbHp;

        //DB에서 휴대번호로 검색해 데이터를 찾아냄
        usersDB.where("hp", "==", tapData_id.hp)
              .where("name", "==", tapData_id.name) // where 2개의 절을 연속으로 쓰면 and연산임
          .get()
          .then(function (querySnapshot) {
            console.log(querySnapshot.size)
            if(querySnapshot.size==0){
              app.dialog.alert("등록되지 않은 정보입니다.");
            }
            querySnapshot.forEach(function (doc) {
              // doc.data() is never undefined for query doc snapshots
              // console.log(doc.id, " => ", doc.data());
              dbEmail = doc.data().email,
              dbName = doc.data().name,
              dbHp = doc.data().hp;
              // app.dialog.alert(dbEmail + " " + dbName + " " + dbHp);
              app.dialog.alert("회원님의 이메일은 " + dbEmail + "입니다.");

              // if (tapData_id.name == dbName && tapData_id.hp == dbHp) {
              //                 }  
              // else {
              //   app.dialog.alert("등록되지 않은 정보입니다."); //휴대번호가 같은 상태에서만 밑의 alert가 뜨는 버그가 있음 (논리 오류?)
              // }

            });
          })
          .catch(function (error) {
            console.log("Error getting documents: ", error);
          });
      },
      // end 이메일 찾기 함수


      // 비밀번호 찾기 함수
      pwAlert: function () {
        var self = this;
        var app = self.$app
        var tapData_id = app.form.convertToData('#tap2');
        var usersDB = firebase.firestore().collection("users");
        var dbEmail, dbName, dbHp;








      }
      // end 비밀번호 찾기 함수

    }
  };
</script>